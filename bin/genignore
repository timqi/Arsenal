#!/usr/bin/env python

import os

global_ignores = ['.tags', '*.swp', '*__pycache__*', '*.pyc']


def find_project_dir():
    project_root_indicator = [".git", ".hg", ".svn", ".gitignore"]
    directory = os.path.abspath(os.path.curdir)
    while not directory == "/":
        for indicator in project_root_indicator:
            if os.path.exists(os.path.join(directory, indicator)):
                return directory
        directory = os.path.split(directory)[0]
    return os.path.abspath(os.path.curdir)


def main():
    project_root = find_project_dir()
    global global_ignores
    filename = os.path.join(project_root, '.gitignore')
    if os.path.exists(filename):
        with open(filename, 'r') as f:
            for line in f:
                line = line.strip()
                if line in global_ignores:
                    global_ignores.remove(line)

    title = ""
    if len(global_ignores) > 0:
        title = "\n" if os.path.getsize(filename) != 0 else ""
        title = title + "# Generated by genignore (Arsenal)"

    with open(filename, 'a') as f:
        if title: f.write(title + "\n")
        for ignore in global_ignores:
            f.write(ignore + "\n")
            print("append: " + ignore)


if __name__ == '__main__':
    main()
